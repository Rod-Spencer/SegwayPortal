using Microsoft.AspNetCore.Components;
using Segway.EF.SegwayCntxt;
using Segway_Portal.Models;

namespace Segway_Portal.Components.Pages
{
    public partial class Login : ComponentBase
    {
        ////////////////////////////////////////////////////////////////////////////////////////////////////
        #region Constructors
        #endregion
        ////////////////////////////////////////////////////////////////////////////////////////////////////


        ////////////////////////////////////////////////////////////////////////////////////////////////////
        #region Parameters
        #endregion Parameters
        ////////////////////////////////////////////////////////////////////////////////////////////////////


        ////////////////////////////////////////////////////////////////////////////////////////////////////
        #region Injections
        #endregion Injections
        ////////////////////////////////////////////////////////////////////////////////////////////////////


        ////////////////////////////////////////////////////////////////////////////////////////////////////
        #region Private Properties

        private LoginModel model = new();
        private string? error;

        #endregion Private Properties
        ////////////////////////////////////////////////////////////////////////////////////////////////////


        ////////////////////////////////////////////////////////////////////////////////////////////////////
        #region Public Properties
        #endregion Public Properties
        ////////////////////////////////////////////////////////////////////////////////////////////////////


        ////////////////////////////////////////////////////////////////////////////////////////////////////
        #region Screen State Properties
        #endregion Screen State Properties
        ////////////////////////////////////////////////////////////////////////////////////////////////////


        ////////////////////////////////////////////////////////////////////////////////////////////////////
        #region Override Methods
        #endregion Override Methods
        ////////////////////////////////////////////////////////////////////////////////////////////////////


        ////////////////////////////////////////////////////////////////////////////////////////////////////
        #region Protected Methods
        #endregion
        ////////////////////////////////////////////////////////////////////////////////////////////////////


        ////////////////////////////////////////////////////////////////////////////////////////////////////
        #region Public Methods
        #endregion
        ////////////////////////////////////////////////////////////////////////////////////////////////////


        ////////////////////////////////////////////////////////////////////////////////////////////////////
        #region Private Methods

        private async Task HandleLogin()
        {
            error = null;

            using var segDB = new SegwayContext();
            var user = segDB.ServiceUsers.FirstOrDefault(u => u.UserName == model.Username);
            if (user == null)
            {
                error = "Invalid username or password.";
                return;
            }

            if (user.UserPassword != model.Password)
            {
                error = "Invalid username or password.";
                return;
            }

            //var response = await Http.PostAsJsonAsync("/login", model);

            //if (response.IsSuccessStatusCode)
            //{
            //    // Force a full navigation so the authentication cookie is picked up by the circuit
            //    Navigation.NavigateTo("/", true);
            //    return;
            //}

            //if (response.StatusCode == System.Net.HttpStatusCode.Unauthorized)
            //{
            //    error = "Invalid username or password.";
            //    return;
            //}

            error = "Login failed.";
        }


        #endregion
        ////////////////////////////////////////////////////////////////////////////////////////////////////
    }

}
